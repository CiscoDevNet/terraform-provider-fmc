# Manual resource - Create
# FMCBUG CSCwq59962 FMC API: RA VPN local realm cannot be set until connection profiles are configured
---
name: VPN RA
rest_endpoint: /api/fmc_config/v1/domain/{DOMAIN_UUID}/policy/ravpns
res_description: This resource manages FTD Remote Access (RA) Virtual Private Networks (VPNs).
doc_category: VPN
attributes:
  - model_name: name
    type: String
    mandatory: true
    description: Name of the VPN Remote Access (RA) Topology.
    example: my_ftd_ra_vpn
    data_source_query: true
  - model_name: description
    type: String
    description: Description of the object.
    example: description of my_fmc_ra_vpn
  - model_name: type
    type: String
    description: Type of the object; this value is always 'RAVpn'.
    computed: true

  # General
  - model_name: configureSSL
    type: Bool
    tf_name: protocol_ssl
    description: Enable SSL protocol for the VPN.
    example: true
    default_value: true
  - model_name: configureIpsec
    type: Bool
    tf_name: protocol_ipsec_ikev2
    description: Enable IPsec IKEv2 protocol for the VPN.
    example: true
    default_value: true
  - model_name: id
    data_path: [localRealmServer]
    type: String
    tf_name: local_realm_id
    description: Local realm server for the VPN.
    example: 12345678-1234-1234-1234-123456789012
  - model_name: id
    data_path: [dapPolicy]
    tf_name: dap_policy_id
    type: String
    description: Identifier for the DAP (Dynamic Access Policy) used for the VPN.
    example: 12345678-1234-1234-1234-123456

  # Connection profile
  # Configuration managed by another endpoint
  # No valid 'id', since this is a list
  # - data_path: [connectionProfiles]
  #   tf_name: connection_profile_id
  #   type: List
  
  # Access Interfaces
  - model_name: interfaceSettings
    data_path: [accessInterfaceSettings]
    tf_name: access_interfaces
    type: List
    attributes:
      - model_name: id
        type: String
        data_path: [accessInterface]
        tf_name: id
        id: true
        description: Id of interface group or security zone.
      - model_name: enableIPSecIkev2
        type: Bool
        tf_name: protocol_ipsec_ikev2
        description: Enable IPsec IKEv2 for the VPN.
        example: true
        default_value: true
      - model_name: enableSSL
        type: Bool
        tf_name: protocol_ssl
        description: Enable SSL for the VPN.
        example: true
        default_value: true
      - model_name: enableDTLS
        type: Bool
        tf_name: protocol_ssl_dtls
        description: Enable DTLS for the VPN.
        example: true
        default_value: true
      # - model_name: configureInterfaceIDCertificate
      #   tf_name: interface_specific_certificate
      #   type: Bool
      #   description: Configure Interface ID Certificate for the VPN.
      #   example: true
      - model_name: id
        data_path: [idCertificate]
        tf_name: interface_specific_certificate_id
        type: String
        description: Identifier for the ID certificate used for the VPN.
        example: 12345678-1234-1234-1234-123456
  - model_name: allowConnectionProfileSelection
    data_path: [accessInterfaceSettings]
    tf_name: allow_users_to_select_connection_profile
    type: Bool
    description: Allow users to select a connection profile.
    example: true
  # FMCBUG CSCwq59114 FMC API: Missing httpOnlyVpnCookie field in /policy/ravpns endpoint
  # - model_name: httpOnlyVpnCookie
  #   data_path: [accessInterfaceSettings]
  #   tf_name: http_only_vpn_cookies
  #   type: Bool
  #   description: Use HTTP-only cookies for the VPN.
  #   example: true
  - model_name: webPort
    data_path: [accessInterfaceSettings]
    tf_name: web_port
    type: Int64
    description: Port number for the web access of the VPN.
    example: 443
    default_value: 443
  - model_name: dtlsPort
    data_path: [accessInterfaceSettings]
    tf_name: dtls_port
    type: Int64
    description: Port number for the web access of the VPN.
    example: 443
    default_value: 443
  - model_name: id
    data_path: [accessInterfaceSettings, sslIdCertificate]
    tf_name: ssl_global_identity_certificate_id
    type: String
    description: Identifier for the SSL certificate used for enrollment.
    example: 12345678-1234-1234-1234-123456
  - model_name: id
    data_path: [accessInterfaceSettings, ipsecIdCertificate]
    tf_name: ipsec_global_identity_certificate_id
    type: String
    description: Identifier for the IPsec certificate used for enrollment.
    example: 12345678-1234-1234-1234-123456
  - model_name: id
    data_path: [accessInterfaceSettings, serviceAccessObject]
    tf_name: service_access_id
    type: String
    description: Identifier for the service access object.
    example: 12345678-1234-1234-1234-123456
  - model_name: bypassACPolicyForDecryptTraffic
    data_path: [accessInterfaceSettings]
    tf_name: bypass_access_control_policy_for_decrypted_traffic
    type: Bool
    description: Bypass Access Control policy for decrypted traffic (sysopt permit-vpn)
    example: true
    default_value: false

  # Advenced - Security Client Images
  - model_name: anyConnectClientImages
    tf_name: secure_client_images
    type: List
    ordered_list: true
    description: List of Secure Client images to be used for the VPN.
    attributes:
      - model_name: id
        data_path: [anyconnectImage]
        type: String
        description: Unique identifier of the Secure Client image.
        mandatory: true
        example: 12345678-1234-1234-1234-123456789012
      - model_name: operatingSystem
        type: String
        description: Operating system of the Secure Client image.
        mandatory: true
        enum_values: [WINDOWS, LINUX, MAC]
        example: WINDOWS
  - model_name: id
    data_path: [externalBrowserPackage]
    tf_name: external_browser_package_id
    type: String
    description: Identifier for the external browser package used for the VPN.
    example: 12345678-1234-1234-1234-123456789012
  
  # Advenced - Secure Client Customization
  # Configuration managed by another endpoint 
  - model_name: id
    data_path: [secureClientCustomizationSettings]
    tf_name: secure_client_customization_id
    type: String
    computed: true

  # Advenced - Address Assignment Policy
  # Configuration managed by another endpoint
  - model_name: id
    data_path: [addressAssignmentSettings]
    tf_name: address_assignment_policy_id
    type: String
    computed: true

  # Advenced - Certificate Maps
  # Configuration managed by another endpoint
  - model_name: id
    data_path: [certificateMapSettings]
    tf_name: certificate_map_id
    type: String
    computed: true
  
  # Advanced - Group Policies
  - model_name: groupPolicies
    tf_name: group_policies
    type: List
    description: List of group policies associated with the VPN. It is mandatory to include at least 'DfltGrpPolicy' in the list.
    mandatory: true
    attributes:
      - model_name: id
        type: String
        description: Unique identifier of the group policy.
        example: 12345678-1234-1234-1234-123456
        mandatory: true

  # Advanced - LDAP Attribute Mapping
  # Configuration managed by another endpoint
  - model_name: id
    data_path: [ldapAttributeMaps]
    tf_name: ldap_attribute_map_id
    type: String
    description: Identifier for the LDAP attribute mapping used for the VPN.
    computed: true

  # Advanced - Load balancing
  # Configuration managed by another endpoint
  - model_name: id
    data_path: [loadBalanceSettings]
    tf_name: load_balance_id
    type: String
    description: Identifier for the load balancing settings used for the VPN.
    computed: true
  
  # Advanced - IPSEC - Crypto Maps
  # Configuration managed by another endpoint
  # No valid 'id', since this is a list
  # - data_path: [ipsecCryptoMaps]
  #   tf_name: ipsec_crypto_map_id
  #   type: List
  
  # Advanced - IPSEC - IKEv2 Policies
  - model_name: ikev2Policies
    tf_name: ikev2_policies
    type: List
    description: List of IKEv2 policies associated with the VPN.
    attributes:
      - model_name: id
        type: String
        description: Unique identifier of the IKEv2 policy.
        example: 12345678-1234-1234-1234-123456789012
        mandatory: true

  # Advanced - IPSEC/IKEv2 Parameters
  # Configuration managed by another endpoint
  - model_name: id
    data_path: [ipsecAdvancedSettings]
    tf_name: ipsec_advanced_settings_id
    type: String
    description: Identifier for the IPsec/IKEv2 advanced settings used for the VPN.
    computed: true
